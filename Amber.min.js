/*!
 * amber v0.5.0 - https://github.com/isuttell/Amber
 * A View system for javascript applications
 * Contributor(s): Isaac Suttell <isaac@isaacsuttell.com>
 */

!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["lodash","jquery","exports"],function(c,d,e){return b(a,e,c,d)}):a.Amber=b(a,{},a._,a.jQuery||a.$)}(this,function(a,b,c,d){"use strict";b.VERSION="0.5.0",b.$=d,b._util={};var e=b._util.isObject=function(a){return"[object Object]"==={}.toString.call(a)},f=b._util.isString=function(a){return"[object String]"==={}.toString.call(a)},g=b._util.isFunction=function(a){return"[object Function]"==={}.toString.call(a)},h=b._util.isIterable=function(a){var b={}.toString.call(a);return"[object Object]"===b||"[object Function]"===b},i=b._util.runOnce=function(a){var b,c;if(!g(a))throw new Error("fn isn't a function");return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}},j=b._util.results=function(a,b,c){if(g(a[b])){var d=Array.prototype.slice.call(arguments).slice(3);return a[b].apply(c||this,d)}return a[b]},k=b._util.assign=function(a){var b=a;if(!h(b))return b;for(var c=arguments.length,d=0;++d<c;){var e=arguments[d];if(h(e))for(var f=-1,g=l(e),i=g.length;++f<i;){var j=g[f];b[j]=e[j]}}return b},l=b._util.keys=function(a){var b,c=[];if(!e(a))return a;for(b in a)a.hasOwnProperty(b)&&c.push(b);return c};b.Supports={tests:{svg:function(){return!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect},draganddrop:function(){var a=document.createElement("div");return"draggable"in a||"ondragstart"in a&&"ondrop"in a},touch:function(){return"ontouchstart"in window||"onmsgesturechange"in window},cssanimations:function(){var a,b=document.body||document.documentElement,c=b.style,d="transition";if(f(c[d]))return!0;a=["Moz","webkit","Webkit","Khtml","O","ms"],d=d.charAt(0).toUpperCase()+d.substr(1);for(var e=0,g=a.length;g>e;e++)if(f(c[a[e]+d]))return!0;return!1},animationframes:function(){for(var a=["ms","moz","webkit","o"],b=0;b<a.length&&!window.requestAnimationFrame;++b)window.requestAnimationFrame=window[a[b]+"RequestAnimationFrame"];return!!window.requestAnimationFrame}},initialize:function(){for(var a in this.tests)this.tests.hasOwnProperty(a)&&(this[a]=j(this.tests,a));return this}}.initialize(),b.Format={numberWithCommas:function(a){return a?a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):a},stripTrailingZero:function(a){return a?a.toString().replace(/\.0/,""):a},basicPluralize:function(a,b){return b&&b>1?a+"s":a}},b.Browser={iOS:null,iPhone:null,iPad:null,android:null,blackberry:null,iemobile:null,firefox:null,chrome:null,safari:null,ie:null,check:function(a){return this.iOS=!!a.match(/iPad|iPhone|iPod/i),this.iPhone=!!a.match(/iPhone/i),this.iPad=!!a.match(/iPad/i),this.android=!!a.match(/Android/i),this.blackberry=!!a.match(/BlackBerry/i),this.iemobile=!!a.match(/IEMobile/i),this.firefox=!!a.match(/Firefox/i),this.chrome=!!a.match(/Chrome/i),this.safari=!!a.match(/(Version\/\d\.\d.*Safari)/i),this.ie=a.match(/MSIE\s([0-9]{1,}[\.0-9]{0,})/i)||!1,this.mobile=this.iOS||this.android||this.blackberry||this.iemobile,this.ie&&(this.ie=Math.floor(this.ie[1])),this}}.check(navigator.userAgent);var m=b.Events={delegateEventSplitter:/^(\S+)\s*(.*)$/,undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},delegateEvents:function(){this.undelegateEvents();for(var a in this.events)if(this.events.hasOwnProperty(a)){var b=this[this.events[a]];b=c.bind(b,this);var d=a.match(this.delegateEventSplitter),e=d[1],f=d[2];e+=".delegateEvents"+this.cid,""===f?this.$el.on(e,b):this.$el.on(e,f,b)}return this},on:function(a,b,c){if(!o(this,"on",a,[b,c])||!b)return this;this._events=this._events||{};var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!o(this,"once",a,[b,c])||!b)return this;var d=this,e=i(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){var d,e,f,g,h,i,j,k;if(!this._events||!o(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(g=a?[a]:l(this._events),h=0,i=g.length;i>h;h++)if(a=g[h],f=this._events[a]){if(this._events[a]=d=[],b||c)for(j=0,k=f.length;k>j;j++)e=f[j],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=[].slice.call(arguments,1);if(!o(this,"trigger",a,b))return this;var c=this._events[a];return c&&p(c,b),this},_ensureElement:function(){if(this.$el)this.setElement(j(this,"$el"),!1);else{var a=k({},j(this,"attributes"));this.id&&(a.id=j(this,"id")),this.className&&(a["class"]=j(this,"className"));var c=b.$("<"+j(this,"tagName")+">").attr(a);this.setElement(c,!1)}}},n=/\s+/,o=function(a,b,c,d){if(!c)return!0;if(n.test(c)){for(var e=c.split(n),f=0,g=e.length;g>f;f++)a[b].apply(a,[e[f]].concat(d));return!1}return!0},p=function(a,b){for(var c,d=-1,e=a.length;++d<e;)(c=a[d]).callback.apply(c.ctx,b)},q=function(){this.cid=c.uniqueId("vent")};k(q.prototype,m),b.Vent=new q,b.Views={_views:[],_add:function(a){this._views.push(a)},get:function(a){return c.find(this._views,function(b){return b.cid===a})},all:function(){return this._views},_clear:function(a){if(f(a)){var b=c.findIndex(this._views,function(b){return b.cid===a});this._views[b].remove(),this._views.splice(b,1)}else{for(var d=0;d<this._views.length;d++)this._views[d].remove();this._views=[]}}};var r=b.View=function(a){this.cid=c.uniqueId("view"),b.Views._add(this),this.options=a||{},k(this,a),this._ensureElement(),this.initialize.apply(this,arguments),this.trigger("after:initialize"),this.delegateEvents()};k(r.prototype,m,{tagName:"div",template:"",events:{},model:{},initialize:function(){},render:function(){this.trigger("before:render");var a={};return a=this.model||{},this.$el.html(c.template(this.template,a)),this.trigger("after:render"),this},$:function(a){return this.$el.find(a)},remove:function(){return this.$el.remove(),this},setElement:function(a,c){return this.$el&&this.undelegateEvents(),this.$el=a instanceof b.$?a:b.$(a),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this}});var s=function(a,b){var d,e=this;d=a&&c.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},k(d,e,b);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,a&&k(d.prototype,a),d.__super__=e.prototype,d};return r.extend=s,b.Preload=function(a,d){var e,h,i,j;f(a)&&(a=[a]),d=d||{},e=[],h=0,i=g(d.progress)?d.progress:!1,j=g(d.done)?d.done:!1;var k=function(){h++,i&&i(h/a.length,h,a.length,e[e.length-1]),h===a.length&&j&&j(e)};c.each(a,function(a){if(f(a)){var c=new Image;c.src=a,b.Preload.isImageLoaded(c)?k.apply(c):(c.onload=k,c.onerror=k),e.push(c)}})},b.Preload.isImageLoaded=function(a){return a.complete?"undefined"!=typeof a.naturalWidth&&0===a.naturalWidth?!1:!0:!1},b});